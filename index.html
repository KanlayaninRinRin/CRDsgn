<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Character Research Reference</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#fdf5ef;
  color:#3a2c2a;
  margin:0;
}
.container {
  max-width:1100px;
  margin:auto;
  padding:20px;
}
h1 { text-align:center; }

input,button {
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
button {
  background:#8b5e3c;
  color:white;
  border:none;
}
button:hover { background:#70482d; }

.tag-box {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:10px 0 20px;
}
.tag {
  background:#e6d4c5;
  padding:6px 14px;
  border-radius:20px;
  font-size:12px;
  cursor:pointer;
}
.tag.active {
  background:#8b5e3c;
  color:white;
}

.feed {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:24px;
}
.card {
  background:#fff8f0;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}
.card img {
  width:100%;
  height:180px;
  object-fit:cover;
}
.card .content { padding:12px; }
</style>
</head>

<body>
<div class="container">

<h1>Character Research Reference</h1>

<label>แท็กที่เลือก / พิมพ์เพิ่มได้</label>
<input id="search-input" placeholder="เช่น magic dream city psychology">

<label>แท็กแนะนำ</label>
<div id="tag-box" class="tag-box"></div>

<button id="search-btn">ค้นหา</button>

<div id="feed" class="feed"></div>

</div>

<script>
const SUGGESTED_TAGS = [
  "magic","ritual","dream","memory","identity","city","urban","fantasy",
  "symbol","psychology","myth","artifact","technology","society","dark",
  "ancient","future","emotion","subconscious","surreal","character",
  "worldbuilding","concept","narrative","portal","legend"
];

const tagBox = document.getElementById("tag-box");
const searchInput = document.getElementById("search-input");
const feed = document.getElementById("feed");

const activeTags = new Set();

function renderTags(){
  tagBox.innerHTML = "";
  SUGGESTED_TAGS.forEach(t=>{
    const el = document.createElement("div");
    el.className = "tag" + (activeTags.has(t) ? " active" : "");
    el.textContent = t;
    el.onclick = ()=>{
      activeTags.has(t) ? activeTags.delete(t) : activeTags.add(t);
      searchInput.value = [...activeTags].join(" ");
      renderTags();
    };
    tagBox.appendChild(el);
  });
}
renderTags();

document.getElementById("search-btn").onclick = async ()=>{
  const q = searchInput.value.trim();
  if(!q) return alert("กรุณาใส่อย่างน้อย 1 แท็ก");

  feed.innerHTML = "กำลังโหลด...";
  const res = await fetch(
    `https://fragrant-leaf-5042.jnnp1591.workers.dev/?q=${encodeURIComponent(q)}`
  );
  const data = await res.json();

  feed.innerHTML = "";
  data.forEach(item=>{
    const c = document.createElement("div");
    c.className = "card";
    if(item.type==="image"){
      c.innerHTML = `<img src="${item.imageUrl}"><div class="content">${item.title}</div>`;
    } else {
      c.innerHTML = `<div class="content"><strong>${item.title}</strong></div>`;
    }
    feed.appendChild(c);
  });
};
</script>
</body>
</html>
