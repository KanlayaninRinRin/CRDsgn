<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Character Research Reference</title>

<style>
/* üîí UI ‡πÄ‡∏î‡∏¥‡∏° */
body {
  font-family: Arial, sans-serif;
  background:#fdf5ef;
  color:#3a2c2a;
  margin:0;
}
.container {
  max-width:1100px;
  margin:auto;
  padding:20px;
}
h1 {
  text-align:center;
  margin-bottom:20px;
}
input,button {
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
button {
  background:#8b5e3c;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover { background:#70482d; }
button.disabled {
  background:#ccc;
  cursor:not-allowed;
}

.feed {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:24px;
  margin-top:30px;
}
.card {
  background:#fff8f0;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}
.card img {
  width:100%;
  height:180px;
  object-fit:cover;
  display:block;
}
.card .content {
  padding:12px;
}
.card h4 {
  margin:0 0 6px 0;
  font-size:14px;
}
.card p {
  font-size:12px;
  margin:4px 0;
}
.card a {
  color:#8b5e3c;
  font-size:13px;
  text-decoration:none;
}

.nav-buttons {
  display:flex;
  gap:12px;
  margin:30px 0;
  justify-content:center;
}
.end-message {
  text-align:center;
  color:#8b5e3c;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="container">

<h1>Character Research Reference</h1>

<label>‡πÅ‡∏ó‡πá‡∏Å (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏´‡∏£‡∏∑‡∏≠ , )</label>
<input
  id="search-input"
  placeholder="‡πÄ‡∏ä‡πà‡∏ô magic city ritual dream psychology"
/>

<button id="search-btn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

<div id="feed" class="feed"></div>

<div class="nav-buttons">
  <button id="prev-btn" style="display:none;">‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  <button id="next-btn" style="display:none;">‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
</div>

<div id="end-msg" class="end-message" style="display:none;">
  ‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
</div>

</div>

<script>
const searchInput = document.getElementById("search-input");
const searchBtn = document.getElementById("search-btn");
const feed = document.getElementById("feed");
const nextBtn = document.getElementById("next-btn");
const prevBtn = document.getElementById("prev-btn");
const endMsg = document.getElementById("end-msg");

let currentPage = 1;
let reachedEnd = false;

function resetNav(){
  reachedEnd = false;
  endMsg.style.display = "none";
  nextBtn.disabled = false;
  nextBtn.classList.remove("disabled");
}

async function loadFeed(reset=false){
  const query = searchInput.value.trim();

  if(!query){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÅ‡∏ó‡πá‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥");
    return;
  }

  if(reset){
    currentPage = 1;
    resetNav();
  }

  feed.innerHTML = "<p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>";

  try{
    const res = await fetch(
      `https://fragrant-leaf-5042.jnnp1591.workers.dev/?q=${encodeURIComponent(query)}&page=${currentPage}`
    );

    const data = await res.json();
    feed.innerHTML = "";

    if(!Array.isArray(data) || data.length === 0){
      reachedEnd = true;
      nextBtn.disabled = true;
      nextBtn.classList.add("disabled");
      endMsg.style.display = "block";
      return;
    }

    data.forEach(item=>{
      const card = document.createElement("div");
      card.className = "card";

      if(item.type === "image"){
        card.innerHTML = `
          <img src="${item.imageUrl}"
               loading="lazy"
               referrerpolicy="no-referrer">
          <div class="content">
            <h4>${item.title || "Untitled image"}</h4>
            <p>${item.source || ""}</p>
          </div>
        `;
      }

      if(item.type === "research"){
        card.innerHTML = `
          <div class="content">
            <h4>${item.title || "Untitled research"}</h4>
            <p>${item.authors || "Unknown author"}</p>
            <a href="${item.link}"
               target="_blank"
               rel="noopener">‡∏≠‡πà‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢</a>
          </div>
        `;
      }

      if(item.type === "text"){
        card.innerHTML = `
          <div class="content">
            <h4>${item.title || "Untitled text"}</h4>
            <p>${item.excerpt || ""}</p>
            <p><em>${item.source || ""}</em></p>
          </div>
        `;
      }

      feed.appendChild(card);
    });

    nextBtn.style.display = "block";
    prevBtn.style.display = currentPage > 1 ? "block" : "none";

  }catch(err){
    feed.innerHTML = "<p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>";
  }
}

searchBtn.onclick = ()=>loadFeed(true);

nextBtn.onclick = ()=>{
  if(!reachedEnd){
    currentPage++;
    loadFeed();
  }
};

prevBtn.onclick = ()=>{
  if(currentPage > 1){
    currentPage--;
    loadFeed();
  }
};
</script>

</body>
</html>
