<div class="container">

  <h3>เลือกหมวดข้อมูล</h3>
  <select id="category">
    <option value="">-- เลือกประเภทข้อมูล --</option>
    <option value="inspiration">แรงบันดาลใจ</option>
    <option value="biology">ชีวภาพ</option>
    <option value="psychology">จิตวิทยา</option>
    <option value="society">สังคม</option>
  </select>

  <input type="text" id="search-input" placeholder="พิมพ์คำค้นหา">
  <button id="search-btn">ค้นหา</button>

  <div class="feed" id="feed"></div>
</div>

<script>
const categorySelect = document.getElementById("category");
const searchInput = document.getElementById("search-input");
const searchBtn = document.getElementById("search-btn");
const feed = document.getElementById("feed");
let loading = false;

// ฟังก์ชันโหลด feed
async function loadFeed() {
  const category = categorySelect.value;
  const query = searchInput.value.trim();

  if(!category) return alert("กรุณาเลือกหมวด");
  if(!query) return alert("กรุณากรอกคำค้น");

  feed.innerHTML = "<p>กำลังโหลด...</p>";
  loading = true;

  try {
    const res = await fetch(`https://YOUR_WORKER_URL/?category=${category}&q=${encodeURIComponent(query)}`);
    const data = await res.json();
    feed.innerHTML = "";

    if(!data || data.length === 0){
      feed.innerHTML = "<p>ไม่พบผลลัพธ์</p>";
      loading = false;
      return;
    }

    data.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";

      if(item.type === "image"){
        card.innerHTML = `
          <img src="${item.image}" loading="lazy">
          <div class="content">
            <h4>${item.title}</h4>
          </div>
        `;
      } else if(item.type === "research"){
        card.innerHTML = `
          <div class="content" style="padding:20px; text-align:center;">
            <h4>${item.title}</h4>
            <a href="${item.link}" target="_blank">งานวิจัย</a>
          </div>
        `;
      }

      feed.appendChild(card);
    });

  } catch(err){
    console.error(err);
    feed.innerHTML = "<p>เกิดข้อผิดพลาดในการโหลดข้อมูล</p>";
  }

  loading = false;
}

// กดปุ่มค้นหา
searchBtn.addEventListener("click", loadFeed);

// กด Enter ในช่อง input ก็ค้นหาได้
searchInput.addEventListener("keypress", e => {
  if(e.key === "Enter") loadFeed();
});
</script>
